@model DGSyTI_WEB.Models.ConfiguracionInstitucionViewModel

@using (Ajax.BeginForm("GuardarConfigInstitucion", "ConfiguracionInstitucion", new { model = Model }, new AjaxOptions
{
    HttpMethod = "POST",
    OnSuccess = "successGuardarConfigInstitucion",
    LoadingElementId = "divLoading",
}, new { id = "formConfiguracionInstitucion" }))
{
    @Html.HiddenFor(m => m.insId)
    @Html.HiddenFor(m => m.InsNombre)
    <div width="100%">
        <table width="100%">
            <tr>
                <td></td>
            </tr>
            <tr class=" color backgroundAzul2 colorWhite" style="text-align:center; height:30px;">
                <td colspan="3" style="padding:3px; font-size:14px; text-align:center;">Clave de institución @Model.insId</td>
            </tr>
            <tr style="height:30px;">
                <th class="colorGris headerTablaGris" style="text-align:left;padding-left:2%; justify-content: right;">Configuración del portal de descarga:</th>
            </tr>
            <tr class="rowTablaGris row">
                <td class="col-form-label label field-text  " width="200px">Certificados públicos en otras instituciones:</td>
                <td class="info" width="350px" style="display: flex;align-items: center;">
                    @Html.CheckBox("insCertificadosPublicos", Convert.ToBoolean(Model.insCertificadosPublicos))
                    @*@Html.CheckBoxFor(m => m.insCertificadosPublicos.Value)*@
                </td>
            </tr>
            <tr class="rowTablaGris row">
                <td class="col-form-label label field-text" width="200px" style="padding-left:2%; justify-content: right;align-items:center;">Url de botón menú:</td>
                <td class="info" width="350px" style="display: flex;align-items: center;">
                    <ul style="list-style: none;padding: 0px;margin: 0px;width:100%;">
                        <li>
                            @Html.TextBoxFor(m => m.insBotonMenu)
                        </li>
                        <li>
                            @Html.ValidationMessageFor(m => m.insBotonMenu)
                        </li>
                    </ul>
                </td>
            </tr>
            <tr class="rowTablaGris row">
                <td class="col-form-label label field-text" width="200px">Url de botón salir:</td>
                <td class="info" width="350px" style="display: flex;align-items: center;">
                    <ul style="list-style: none;padding: 0px;margin: 0px;width:100%;">
                        <li>
                            @Html.TextBoxFor(m => m.insBotonSalir)
                        </li>
                        <li>
                            @Html.ValidationMessageFor(m => m.insBotonSalir)
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="height:30px;">
                <th class="colorGris headerTablaGris" style="text-align:left;padding-left:2%;">Datos del servicio web de SEP:</th>
            </tr>
            <tr class="rowTablaGris row">
                <td class="label field-text" width="200px" style="justify-content: right;  align-items: center;">
                    Usuario:
                </td>
                <td class="info" style="align-items: center;width: 350px;">
                    <ul style="list-style: none;padding: 0px;margin: 0px; width:100%;">
                        <li>
                            @Html.TextBoxFor(m => m.insUsuarioWS)
                        </li>
                        <li>
                            @Html.ValidationMessageFor(m => m.insUsuarioWS)
                        </li>
                    </ul>
                </td>
            </tr>
            <tr class="rowTablaGris row">
                <td class="label field-text" width="200px" style="justify-content: right; align-items:center;">Contraseña:</td>
                <td class="info" style="display: flex;align-items: center;width: 350px;">
                    <div id="container" style="position: relative; display:inline-block">
                        @Html.TextBoxFor(m => m.insContrasenaWS, new
                    {
                        @id = "insContrasenaWS",
                        @name = "insContrasenaWS",
                        @class = "valid",
                        @type = "password",
    @style = "width: 300px;border: 1px solid #00a6e3; background: #fff;font-family: Verdana, Arial,Helvetica; color: #333;font-size: 9pt;margin: 0px; "
    })
                        <div id="show-hide-passwdWS" action="hide" class="input-group-addon glyphicon glyphicon glyphicon-eye-open" style="position: absolute; top: 0; right: 0; background: lightgrey; height: 29px; width: 25px; cursor: pointer; border: 1px solid #00a6e3; top: 0px; background-color: #F7F7F7; padding: 1px !important">
                        </div>
                        @Html.ValidationMessageFor(m => m.insContrasenaWS)
                    </div>
                </td>
            </tr>
            <tr style="height:35px;">
                <th class="colorGris headerTablaGris" style="height:30px; text-align:left;padding-left:2%; border-bottom:7px solid #fff;">Credenciales del servicio web de certificados electrónicos:</th>
            </tr>
            <tr class="rowTablaGris row">
                <td class="label field-text labelObligatorio" width="200px">Token de portal de descarga:</td>
                <td class="info" width="310px" style="display: flex;align-items: center;">
                    <div id="container" style="position: relative; display:inline-block">
                        @Html.TextBoxFor(m => m.insTokenSeguridadDescarga, new
                    {
                        @readonly = "readonly",
                        @id = "insTokenSeguridadDescarga",
                        @name = "insTokenSeguridadDescarga",
                        @class = "valid",
                        @type = "password",
    @style = "width: 300px;border: 1px solid #00a6e3; background: #fff;font-family: Verdana, Arial,Helvetica; color: #333;font-size: 9pt;margin: 0px;"
    })
                        <div id="show-hide-passwdDescarga" action="hide" class="input-group-addon glyphicon glyphicon glyphicon-eye-open" style="position: absolute; top: 0; right: 0; background: lightgrey; height: 29px; width: 25px; cursor: pointer; border: 1px solid #00a6e3; top: 0px; background-color: #F7F7F7; padding: 1px !important"></div>
                    </div>
                    @Html.ValidationMessageFor(m => m.insTokenSeguridadDescarga)
                </td>
                <td>
                    <a onclick="obtenerNuevoGUID('insTokenSeguridadDescarga')" class="tit-EstiloBtnAncla" style="background: url(../Images/Compartidas/Iconos/icono_refresh.png) no-repeat;">Generar nuevo token</a>
                </td>
            </tr>
            <tr style="height:35px;">
                <th colspan="3" class="colorGris headerTablaGris" style="height:30px;text-align: left; padding-left: 2%; border-top: 10px solid #fff">Flujo de firma:</th>
            </tr>
            <tr class="rowTablaGris row">
                <td class="label field-text" width="200px">Notificar vía correo a profesionista:</td>
                <td class="info" style="display: flex;align-items: center;">
                    @Html.CheckBox("insNotificacionProfesionista", Convert.ToBoolean(Model.insNotificacionProfesionista))
                </td>
            </tr>
            <tr class="rowTablaGris row">
                <td colspan="2">
                    <div id="tblVariables"></div>
                </td>
            </tr>
        </table>
    </div>
    if (Helpers.ValidaAccesoAttribute.validaAccion("ConsultarParametrosInstitucion"))
    {
        <div class="colorGris headerTablaGris" style="text-align:left; padding-top: 4px;padding-left:2%;height:30px;">Etiquetas</div>
        <div class="label field-text" style="text-align:left;display: flex;align-items: center;">
            @Ajax.ActionLink("Ver etiquetas", "ListadoEtiquetas", "ConfiguracionInstitucion", new { sIdInstitucion = Model.insId, sIdTipoDocumento = "", iPagina = 1, iBloque = 10 }, new AjaxOptions { HttpMethod = "POST", LoadingElementId = "divLoading", OnSuccess = "iniciarTablaEtiquetas", UpdateTargetId = "idTablaEtiquetas_lista" }, new { @class = "linkPDF" })
        </div>
    }
    if (Helpers.ValidaAccesoAttribute.validaAccion("ConsultarPlantillaInstitucion"))
    {
        <div class="colorGris headerTablaGris" style="text-align:left; padding-top: 4px;padding-left:2%;height:30px;">Plantillas</div>
        <div class="label field-text" style="text-align:left;display: flex;align-items: center;">
            <a href="#" class="linkPDF" onclick="iniciarTablaPlantillas()">Ver plantillas</a>
            @*@Ajax.ActionLink("Ver plantillas", "ListadoPlantillas", "ConfiguracionInstitucion", new { sIdInstitucion = Model.insId, sIdTipoDocumento = "", sIdPlan = "", iPagina = 1, iBloque = 10 }, new AjaxOptions { HttpMethod = "POST", LoadingElementId = "divLoading", OnSuccess = "iniciarTablaPlantillas", UpdateTargetId = "idTablaPlantillas_lista" }, new { @class = "linkPDF" })*@
        </div>
    }
    if (Helpers.ValidaAccesoAttribute.validaAccion("ConsultarFirmantesInstitucion"))
    {
        <div class="colorGris headerTablaGris" style="text-align:left; padding-top: 4px;padding-left:2%;height:30px;">Firmantes</div>
        <div class="label field-text" style="text-align:left;display: flex;align-items: center;">
            @if (Model.oCatFirmante.firCurp != null && Model.oCatFirmante.insId != null)
            {
                if (Helpers.ValidaAccesoAttribute.validaAccion("DescargarCeritficadoInstitucion"))
                {
                    <x>Firmante predeterminado: </x> <div id="lblFirmantePredeterminado">@Html.ActionLink(Model.oCatFirmante.firCurp, "DescargarCertificado", "ConfiguracionInstitucion", new { firId = Model.oCatFirmante.firId, insId = Model.oCatFirmante.insId }, new { @class = "cer-EstiloBtnAncla btnDescargar", download = "download", title = "Descargar certificado" })</div>
                }
            }
            @Ajax.ActionLink("Ver firmantes", "ListadoFirmantes", "ConfiguracionInstitucion", new { sIdInstitucion = Model.insId, sIdTipoDocumento = "", sIdPlan = "", iPagina = 1, iBloque = 10 }, new AjaxOptions { HttpMethod = "POST", LoadingElementId = "divLoading", OnSuccess = "iniciarTablaFirmantes", UpdateTargetId = "idTablaFirmantes_lista" }, new { @class = " linkPDF" })
        </div>
    }

    if (Helpers.ValidaAccesoAttribute.validaAccion("ActualizarInstitucion"))
    {
        <div class="colorGris headerTablaGris" style="text-align: right; padding-left: 2%; padding-right: 3%; ">
            <button class="linkSave colorAzulGto" style="border: 0px!important; background: transparent;" type="submit">Guardar</button>
        </div>
    }
}
<div id="" style="display:none">
    <div>
        <div id="dvAgregarPlantilla">
            @if (Helpers.ValidaAccesoAttribute.validaAccion("ActualizarAgregarPlantillaInstitucion"))
            {
                @Ajax.ActionLink("Agregar plantilla", "EditarPlantilla", "ConfiguracionInstitucion", new { sIdPlantilla = "" }, new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "dvEditarPlantilla", OnSuccess = "MostrarAgregarPlantilla" }, new { @class = "linkAdd" })
            }
        </div>
        <div id="dvAgregarFirmantesHide">
            @if (Helpers.ValidaAccesoAttribute.validaAccion("AgregarActualizarFirmanteInstitucion"))
            {
                @Ajax.ActionLink("Agregar firmante", "EditarFirmante", "ConfiguracionInstitucion", new { sIdPlantilla = "" }, new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "dvEditarFirmantes", OnSuccess = "MostrarAgregarFirmante" }, new { @class = "linkAdd" })
            }
        </div>
    </div>Dat
</div>
<div class="modal fade" id="modalPlantillas" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable" style="max-height:650px !important; max-width: 100% !important;width: 60% !important;left:20% !important;margin-left:0 !important;position: absolute !important;">
        <div class="modal-content" style="width: 100%;">
            <div class="modal-header" style="padding:4px 20px!important">
                <x id="lblTituloModalPlantillas">Configuración de plantillas</x>
            </div>
            <!--Aquí se carga el cuerpo-form del modal-->
            <div class="modal-body">

                <div id="idModalBodyConcentradora">
                    @Helpers.GridHelper.seccionBusqueda("idTablaPlantillas")

                    <div id="idTablaPlantillas_barraAccionesGrid">
                        <div id="dvAgregarPlantilla">
                            @if (Helpers.ValidaAccesoAttribute.validaAccion("ActualizarAgregarPlantillaInstitucion"))
                            {
                                @Ajax.ActionLink("Agregar plantilla", "EditarPlantilla", "ConfiguracionInstitucion", new { sIdPlantilla = "" }, new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "dvEditarPlantilla", OnSuccess = "MostrarAgregarPlantilla" }, new { @class = "linkAdd" })
                            }
                        </div>
                    </div>
                    <div id="idTablaPlantillas_lista"></div>
                </div>
                <div id="dvEditarPlantilla" style="display:none;"></div>
                <div id="divFormularioEditarPlantilla" style="display:none;">
                    <div class="row col-12 colorGris headerTablaGris" style="text-align:center;display: flex;justify-content: left;align-items: center; height:30px;">Agregar plantilla</div>
                </div>
            </div>
            <!--Barra de botones-->
            <div class="modal-footer">
                <a class="linkCancelar colorAzul" onclick="SuccessEditarPlantilla()" id="btnCancelarPlantilla" style="display:none; cursor:pointer" title="Cancelar">Cancelar</a>
                <a class="linkSave colorAzul linkHover" onclick="EditarPlantilla()" id="btnGuardarPlantilla" style="display:none; cursor:pointer" title="Guardar">Guardar</a>
                <a id="btnCerrarModal" type="button" class="btnCancelar linkHover" data-dismiss="modal" style="width: 73px;padding: 3px; font-weight:normal;" onclick="onHideModalPlantillas()" title="Cerrar">Cerrar</a>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="modalEtiquetas" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable" style="max-height:650px !important; max-width: 100% !important;width: 60% !important;left:20% !important;margin-left:0 !important;position: absolute !important;">
        <div class="modal-content" style="width: 100%;">
            <div class="modal-header" style="padding:4px 20px !important">
                Configuración de etiquetas
            </div>
            <div class="modal-body">
                <div id="divFormularioEditarEtiqueta">
                </div>
                @Helpers.GridHelper.seccionBusqueda("idTablaEtiquetas")
                <div id="idTablaEtiquetas_barraAccionesGrid"></div>
                <div id="idTablaEtiquetas_lista"></div>
            </div>
            <!--Barra de botones-->
            <div class="modal-footer">
                <a class="btnCancelar linkHover" data-dismiss="modal" style="width: 73px;padding: 3px; font-weight:normal;" onclick="onHideModalEtiquetas();" title="Cerrar">Cerrar</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalFirmantes" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable" style="max-height:650px !important; max-width: 100% !important;width: 60% !important;left:20% !important;margin-left:0 !important;position: absolute !important;">
        <div class="modal-content" style="width: 100%;">
            <div class="modal-header" style="padding:4px 20px!important">
                <x id="lblTituloModalFirmantes">Configuración de firmantes</x>
            </div>
            <!--Aquí se carga el cuerpo-form del modal-->
            <div class="modal-body">
                <div id="idModalBodyFirmantes">
                    <div id="idTablaFirmantes_barraAccionesGrid">
                        <div id="dvAgregarFirmantes">
                            @if (Helpers.ValidaAccesoAttribute.validaAccion("AgregarActualizarFirmanteInstitucion"))
                            {
                                @Ajax.ActionLink("Agregar firmante", "EditarFirmante", "ConfiguracionInstitucion", new { sIdPlantilla = "" }, new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "dvEditarFirmantes", OnSuccess = "MostrarAgregarFirmante" }, new { @class = "linkAdd" })
                            }
                        </div>
                    </div>
                    <div id="idTablaFirmantes_lista"></div>
                </div>
                <div id="dvEditarFirmantes" style="display:none;"></div>
                <div id="divFormularioEditarFirmantes" style="display:none;">
                    <div class="row col-12 colorGris headerTablaGris" style="text-align:center;display: flex;justify-content: left;align-items: center; height:30px;">Agregar plantilla</div>
                </div>
            </div>
            <!--Barra de botones-->
            <div class="modal-footer">
                <a class="linkCancelar colorAzul" onclick="SuccessEditarFirmante()" id="btnCancelarFirmante" style="display:none; cursor:pointer" title="Cancelar">Cancelar</a>
                <a class="linkSave colorAzul linkHover" onclick="EditarFirmante()" id="btnGuardarFirmante" style="display:none; cursor:pointer" title="Guardar">Guardar</a>
                <a id="btnCerrarModalFirmante" type="button" class="btnCancelar linkHover" data-dismiss="modal" style="width: 73px;padding: 3px; font-weight:normal;" onclick="onHideModalFirmantes()" title="Cerrar">Cerrar</a>
            </div>
        </div>
    </div>
</div>

<script>
    $q('#show-hide-passwd').on('click', function (e) {
        if ((($q("#insTokenSeguridad").val() != '12345') && ($q("#insTokenSeguridad").val().length != 0))) {
            e.preventDefault();
            var current = $q(this).attr('action');
            if (current == 'hide') {
                $q(this).prev().attr('type', 'text');
                $q(this).removeClass('glyphicon-eye-open').addClass('glyphicon-eye-close').attr('action', 'show');
            }
            if (current == 'show') {
                $q(this).prev().attr('type', 'password');
                $q(this).removeClass('glyphicon-eye-close').addClass('glyphicon-eye-open').attr('action', 'hide');
            }
        }
    });

    $q('#show-hide-passwdDescarga').on('click', function (e) {
        if ((($q("#insTokenSeguridadDescarga").val() != '12345') && ($q("#insTokenSeguridadDescarga").val().length != 0))) {
            e.preventDefault();
            var current = $q(this).attr('action');
            if (current == 'hide') {
                $q(this).prev().attr('type', 'text');
                $q(this).removeClass('glyphicon-eye-open').addClass('glyphicon-eye-close').attr('action', 'show');
            }
            if (current == 'show') {
                $q(this).prev().attr('type', 'password');
                $q(this).removeClass('glyphicon-eye-close').addClass('glyphicon-eye-open').attr('action', 'hide');
            }
        }
    });

    $q('#show-hide-passwdWS').on('click', function (e) {
        if ((($q("#insContrasenaWS").val() != '12345') && ($q("#insContrasenaWS").val().length != 0))) {
            e.preventDefault();
            var current = $q(this).attr('action');
            if (current == 'hide') {
                $q(this).prev().attr('type', 'text');
                $q(this).removeClass('glyphicon-eye-open').addClass('glyphicon-eye-close').attr('action', 'show');
            }
            if (current == 'show') {
                $q(this).prev().attr('type', 'password');
                $q(this).removeClass('glyphicon-eye-close').addClass('glyphicon-eye-open').attr('action', 'hide');
            }
        }
    });
</script>