@model CertificadosEletronicosMS.Models.SelladoViewModel



<!-- Modal para SELLAR -->
<div class="modal fade" id="idModalSellado" role="dialog" aria-labelledby="idModalSelladoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header headerEmergente">
                Sellado
                <button type="button" onclick="LimpiarCamposSellado()" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @using (Html.BeginForm("sellar", "Sellado", FormMethod.Post,
                               new { id = "idFormSellado", enctype = "multipart/form-data" }))
            {
        <div class="modal-body bodyEmergente" style="font-size:9pt;">


            <input type="hidden" class="form-control" id="idFiltros" name="nameFiltros">

            <div class="form-group">
                <span class="mensajeInformativos">*El firmante configurado es: @(Model.firmanteML.firNombre +" "+Model.firmanteML.firPrimerApellido+" "+Model.firmanteML.firSegundoApellido).</span>
             
            </div>

            <div class="form-group">
                <label for="idArchivoKey">Llave privada (.key):</label>
                <input type="file" class="form-control" id="idArchivoKey" name="archivoKey" style="font-size:9pt;" accept=".key" required>

            </div>

            <div class="form-group info">
                <label for="idContrasenia">Contraseña:</label>
                <input type="password" class="form-control" id="idContrasenia" name="nameContrasenia" style="font-size:9pt;" required>

            </div>

        </div>

                <div class="modal-footer footerEmergente">
                    <button type="submit" class="btnAceptar tit-EstiloBtnAncla">Aceptar</button>
                    <button type="button" data-dismiss="modal" class="btnCancelar tit-EstiloBtnAncla" onclick="LimpiarCamposSellado()">Cerrar</button>
                </div>

            }
        </div>
    </div>
</div>


<script>


$q(this).ready(function () {



    $q("#idFormSellado").submit(function (event) {
        var form = $q(this);
        $q('#divLoading').show();
        $q('#idFiltros').val(JSON.stringify(getFiltros()));

        form.ajaxSubmit({
            dataType: 'JSON',
            type: 'POST',
            url: form.attr('action'),
            success: function (mensaje) {
                if (mensaje[0] === "True") {
                   
                    alertify.alert(mensaje[1]).setHeader('<section class="headerAlert text-left" warning>Atención</section>');
                    
                    TerminarSellado()

                } else {
                    alertify.alert(mensaje[1]).setHeader('<section class="headerAlert text-left" warning>Atención</section>');
                }
               
                $q('#divLoading').hide();
            },
            error: function (jqXHR, textStatus, errorThrown) {

                $q('#divLoading').hide();
            }
        });

        return false;
    });
    });

</script>